"use strict";(self["webpackChunkcontrol_robot"]=self["webpackChunkcontrol_robot"]||[]).push([[443],{7274:function(e,t,r){r.r(t),r.d(t,{default:function(){return P}});var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Streaming")],1)},o=[],i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("div",{staticClass:"select-ctn"},[r("select",{directives:[{name:"model",rawName:"v-model",value:e.streamList.selected,expression:"streamList.selected"}],attrs:{disabled:e.stream},on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(e.streamList,"selected",t.target.multiple?r:r[0])}}},e._l(e.streamList.options,(function(t){return r("option",{key:t.id,domProps:{value:t.id}},[e._v(" "+e._s(t.description)+" ")])})),0),r("div",[e._v(e._s(null==e.stream?"null":e.notNull))]),r("button",{staticClass:"btn btn-primary",attrs:{type:"button",disabled:e.stream},on:{click:function(t){return t.preventDefault(),e.start.apply(null,arguments)}}},[e._v("Start")]),r("button",{staticClass:"btn btn-secondary",attrs:{type:"button",disabled:!e.stream},on:{click:function(t){return t.preventDefault(),e.stop.apply(null,arguments)}}},[e._v("Stop")])]),r("div",{staticClass:"md-layout"},[r("div",{staticClass:"md-layout-item"},["starting"==e.status?r("h3",[e._v(" Loading video stream ... ")]):e._e(),r("div",{staticClass:"video-vtn"},[r("video",{ref:"videoStream",attrs:{autoplay:"autoplay",playsinline:"",width:"640px",height:"480px"},domProps:{srcObject:e.stream}})])]),r("div",{staticClass:"md-layout-item"},[r("div",{staticClass:"map-section"},[r("gmap-map",{staticStyle:{width:"80%",height:"50%"},attrs:{center:e.center,zoom:15,options:{zoomControl:!1,scaleControl:!1,mapTypeControl:!1,fullscreenControl:!0,streetViewControl:!1,disableDefaultUi:!1}}},e._l(e.coordinates,(function(t,n){return r("gmap-marker",{key:n,attrs:{position:e.getPosition(t),clickable:!0,icon:e.getMarkers1(n)},on:{click:function(r){return e.toggleInfo(t,n)}}})})),1)],1)])]),r("div",{staticClass:"md-layout"},[r("div",{staticClass:"md-layout-item"},[e.stream?e._e():r("div",[e._v("No Stream")]),r("div",[e._v("Status: "+e._s(e.status?e.status:"No video stream"))]),e.error?r("div",[e._v(e._s(e.error))]):e._e()]),r("div",{staticClass:"md-layout-item"}),r("div",{staticClass:"md-layout-item"})])])},a=[],s=(r(1703),r(7435)["default"]);d.sessions={},d.isExtensionEnabled=function(){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||d.extension.isInstalled()}return!0};var c={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")},init:function(){var e={};this.cache=e,window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var r=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",r(n)}else r(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&(console.log("clearing ",t.data.id),window.clearTimeout(t.data.id))}))}};function d(e){if(e=e||{},e.success="function"==typeof e.success?e.success:d.noop,e.error="function"==typeof e.error?e.error:d.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:d.noop,!d.initDone)return e.error("Library not initialized"),{};if(!d.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(d.log("Library initialized: "+d.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,r=null,n={},o=null,i=null,a=0,s=e.server;d.isArray(s)?(d.log("Multiple servers provided ("+s.length+"), will use the first that works"),s=null,i=e.server,d.debug(i)):0===s.indexOf("ws")?(t=!0,d.log("Using WebSockets to contact Janus: "+s)):(t=!1,d.log("Using REST API to contact Janus: "+s));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],u=e.iceTransportPolicy,l=e.bundlePolicy,p=!0===e.ipv6,f=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(f=!0===e.withCredentials);var m=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(m=e.max_poll_events),m<1&&(m=1);var h=null;void 0!==e.token&&null!==e.token&&(h=e.token);var v=null;void 0!==e.apisecret&&null!==e.apisecret&&(v=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var g=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(g=e.keepAlivePeriod),isNaN(g)&&(g=25e3);var y=6e4;function b(e){var t={high:9e5,medium:3e5,low:1e5};return void 0!==e&&null!==e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(y=e.longPollTimeout),isNaN(y)&&(y=6e4);var S=!1,C=null,T={},w=this,k=0,R={};function P(){if(null!=C)if(d.debug("Long poll..."),S){var t=s+"/"+C+"?rid="+(new Date).getTime();m&&(t=t+"&maxev="+m),h&&(t=t+"&token="+encodeURIComponent(h)),v&&(t=t+"&apisecret="+encodeURIComponent(v)),d.httpAPICall(t,{verb:"GET",withCredentials:f,success:D,timeout:y,error:function(t,r){if(d.error(t+":",r),k++,k>3)return S=!1,void e.error("Lost connection to the server (is it down?)");P()}})}else d.warn("Is the server down? (connected=false)")}function D(e,n){if(k=0,t||void 0===C||null===C||!0===n||P(),t||!d.isArray(e))if("keepalive"!==e["janus"])if("server_info"!==e["janus"])if("ack"!==e["janus"])if("success"!==e["janus"])if("trickle"===e["janus"]){const t=e["sender"];if(!t)return void d.warn("Missing sender...");const r=T[t];if(!r)return void d.debug("This handle is not attached to this session");var o=e["candidate"];d.debug("Got a trickled candidate on session "+C),d.debug(o);var i=r.webrtcStuff;i.pc&&i.remoteSdp?(d.debug("Adding remote candidate:",o),o&&!0!==o.completed?i.pc.addIceCandidate(o):i.pc.addIceCandidate(d.endOfCandidates)):(d.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),i.candidates||(i.candidates=[]),i.candidates.push(o),d.debug(i.candidates))}else{if("webrtcup"===e["janus"]){d.debug("Got a webrtcup event on session "+C),d.debug(e);const t=e["sender"];if(!t)return void d.warn("Missing sender...");const r=T[t];return r?void r.webrtcState(!0):void d.debug("This handle is not attached to this session")}if("hangup"===e["janus"]){d.debug("Got a hangup event on session "+C),d.debug(e);const t=e["sender"];if(!t)return void d.warn("Missing sender...");const r=T[t];if(!r)return void d.debug("This handle is not attached to this session");r.webrtcState(!1,e["reason"]),r.hangup()}else if("detached"===e["janus"]){d.debug("Got a detached event on session "+C),d.debug(e);const t=e["sender"];if(!t)return void d.warn("Missing sender...");const r=T[t];if(!r)return;r.ondetached(),r.detach()}else if("media"===e["janus"]){d.debug("Got a media event on session "+C),d.debug(e);const t=e["sender"];if(!t)return void d.warn("Missing sender...");const r=T[t];if(!r)return void d.debug("This handle is not attached to this session");r.mediaState(e["type"],e["receiving"],e["mid"])}else if("slowlink"===e["janus"]){d.debug("Got a slowlink event on session "+C),d.debug(e);const t=e["sender"];if(!t)return void d.warn("Missing sender...");const r=T[t];if(!r)return void d.debug("This handle is not attached to this session");r.slowLink(e["uplink"],e["lost"],e["mid"])}else{if("error"===e["janus"]){d.error("Ooops: "+e["error"].code+" "+e["error"].reason),d.debug(e);var a=e["transaction"];if(a){var s=R[a];s&&s(e),delete R[a]}return}if("event"===e["janus"]){d.debug("Got a plugin event on session "+C),d.debug(e);const t=e["sender"];if(!t)return void d.warn("Missing sender...");var c=e["plugindata"];if(!c)return void d.warn("Missing plugindata...");d.debug("  -- Event is coming from "+t+" ("+c["plugin"]+")");var u=c["data"];d.debug(u);const r=T[t];if(!r)return void d.warn("This handle is not attached to this session");var l=e["jsep"];l&&(d.debug("Handling SDP as well..."),d.debug(l));var p=r.onmessage;p?(d.debug("Notifying application..."),p(u,l)):d.debug("No provided notification callback")}else{if("timeout"===e["janus"])return d.error("Timeout on session "+C),d.debug(e),void(t&&r.close(3504,"Gateway timeout"));d.warn("Unknown message/event  '"+e["janus"]+"' on session "+C),d.debug(e)}}}else{d.debug("Got a success on session "+C),d.debug(e);const t=e["transaction"];if(t){const r=R[t];r&&r(e),delete R[t]}}else{d.debug("Got an ack on session "+C),d.debug(e);const t=e["transaction"];if(t){const r=R[t];r&&r(e),delete R[t]}}else{d.debug("Got info on the Janus instance"),d.debug(e);const t=e["transaction"];if(t){const r=R[t];r&&r(e),delete R[t]}}else d.vdebug("Got a keepalive on session "+C);else for(var f=0;f<e.length;f++)D(e[f],!0)}function E(){if(s&&t&&S){o=setTimeout(E,g);var e={janus:"keepalive",session_id:C,transaction:d.randomString(12)};h&&(e["token"]=h),v&&(e["apisecret"]=v),r.send(JSON.stringify(e))}}function A(c){var u=d.randomString(12),l={janus:"create",transaction:u};if(c["reconnect"]&&(S=!1,l["janus"]="claim",l["session_id"]=C,r&&(r.onopen=null,r.onerror=null,r.onclose=null,o&&(clearTimeout(o),o=null))),h&&(l["token"]=h),v&&(l["apisecret"]=v),!s&&d.isArray(i)&&(s=i[a],0===s.indexOf("ws")?(t=!0,d.log("Server #"+(a+1)+": trying WebSockets to contact Janus ("+s+")")):(t=!1,d.log("Server #"+(a+1)+": trying REST API to contact Janus ("+s+")"))),t)for(var p in r=d.newWebSocket(s,"janus-protocol"),n={error:function(){if(d.error("Error connecting to the Janus WebSockets server... "+s),d.isArray(i)&&!c["reconnect"])return a++,a===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){A(c)}),200));c.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){R[u]=function(e){if(d.debug(e),"success"!==e["janus"])return d.error("Ooops: "+e["error"].code+" "+e["error"].reason),void c.error(e["error"].reason);o=setTimeout(E,g),S=!0,C=e["session_id"]?e["session_id"]:e.data["id"],c["reconnect"]?d.log("Claimed session: "+C):d.log("Created session: "+C),d.sessions[C]=w,c.success()},r.send(JSON.stringify(l))},message:function(e){D(JSON.parse(e.data))},close:function(){s&&S&&(S=!1,e.error("Lost connection to the server (is it down?)"))}},n)r.addEventListener(p,n[p]);else d.httpAPICall(s,{verb:"POST",withCredentials:f,body:l,success:function(e){if(d.debug(e),"success"!==e["janus"])return d.error("Ooops: "+e["error"].code+" "+e["error"].reason),void c.error(e["error"].reason);S=!0,C=e["session_id"]?e["session_id"]:e.data["id"],c["reconnect"]?d.log("Claimed session: "+C):d.log("Created session: "+C),d.sessions[C]=w,P(),c.success()},error:function(e,t){if(d.error(e+":",t),d.isArray(i)&&!c["reconnect"])return a++,a===i.length?void c.error("Error connecting to any of the provided Janus servers: Is the server down?"):(s=null,void setTimeout((function(){A(c)}),200));""===t?c.error(e+": Is the server down?"):t&&t.error?c.error(e+": "+t.error.message):c.error(e+": "+t)}})}function _(e){if(e=e||{},e.success="function"==typeof e.success?e.success:d.noop,e.error="function"==typeof e.error?e.error:d.noop,d.log("Getting info on Janus instance"),!S)return d.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=d.randomString(12),o={janus:"info",transaction:n};if(h&&(o["token"]=h),v&&(o["apisecret"]=v),t)return R[n]=function(t){d.log("Server info:"),d.debug(t),"server_info"!==t["janus"]&&d.error("Ooops: "+t["error"].code+" "+t["error"].reason),e.success(t)},void r.send(JSON.stringify(o));d.httpAPICall(s,{verb:"POST",withCredentials:f,body:o,success:function(t){d.log("Server info:"),d.debug(t),"server_info"!==t["janus"]&&d.error("Ooops: "+t["error"].code+" "+t["error"].reason),e.success(t)},error:function(t,r){d.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}function I(i){i=i||{},i.success="function"==typeof i.success?i.success:d.noop,i.error="function"==typeof i.error?i.error:d.noop;var a=!0===i.unload,c=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(c=!0===i.notifyDestroyed);var u=!0===i.cleanupHandles;if(d.log("Destroying session "+C+" (unload="+a+")"),!C)return d.warn("No session to destroy"),i.success(),void(c&&e.destroyed());if(u)for(var l in T)N(l,{noRequest:!0});if(!S)return d.warn("Is the server down? (connected=false)"),C=null,void i.success();var p={janus:"destroy",transaction:d.randomString(12)};if(h&&(p["token"]=h),v&&(p["apisecret"]=v),a)return t?(r.onclose=null,r.close(),r=null):navigator.sendBeacon(s+"/"+C,JSON.stringify(p)),d.log("Destroyed session:"),C=null,S=!1,i.success(),void(c&&e.destroyed());if(t){p["session_id"]=C;var m=function(){for(var e in n)r.removeEventListener(e,n[e]);r.removeEventListener("message",g),r.removeEventListener("error",y),o&&clearTimeout(o),r.close()},g=function(t){var r=JSON.parse(t.data);r.session_id==p.session_id&&r.transaction==p.transaction&&(m(),i.success(),c&&e.destroyed())},y=function(){m(),i.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return r.addEventListener("message",g),r.addEventListener("error",y),void(1===r.readyState?r.send(JSON.stringify(p)):y())}d.httpAPICall(s+"/"+C,{verb:"POST",withCredentials:f,body:p,success:function(t){d.log("Destroyed session:"),d.debug(t),C=null,S=!1,"success"!==t["janus"]&&d.error("Ooops: "+t["error"].code+" "+t["error"].reason),i.success(),c&&e.destroyed()},error:function(t,r){d.error(t+":",r),C=null,S=!1,i.success(),c&&e.destroyed()}})}function x(e){if(e=e||{},e.success="function"==typeof e.success?e.success:d.noop,e.error="function"==typeof e.error?e.error:d.noop,e.dataChannelOptions=e.dataChannelOptions||{ordered:!0},e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:d.noop,e.iceState="function"==typeof e.iceState?e.iceState:d.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:d.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:d.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:d.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:d.noop,e.onlocaltrack="function"==typeof e.onlocaltrack?e.onlocaltrack:d.noop,e.onremotetrack="function"==typeof e.onremotetrack?e.onremotetrack:d.noop,e.ondata="function"==typeof e.ondata?e.ondata:d.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:d.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:d.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:d.noop,!S)return d.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return d.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,i=e.loopIndex,a=e.token?e.token:h,c=d.randomString(12),u={janus:"attach",plugin:n,opaque_id:o,loop_index:i,transaction:c};if(a&&(u["token"]=a),v&&(u["apisecret"]=v),t)return R[c]=function(t){if(d.debug(t),"success"!==t["janus"])return d.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var r=t.data["id"];d.log("Created handle: "+r);var o={session:w,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(e,t){return B(r,e,!0,t)},getRemoteVolume:function(e,t){return B(r,e,!0,t)},getLocalVolume:function(e,t){return B(r,e,!1,t)},isAudioMuted:function(e){return q(r,e,!1)},muteAudio:function(e){return K(r,e,!1,!0)},unmuteAudio:function(e){return K(r,e,!1,!1)},isVideoMuted:function(e){return q(r,e,!0)},muteVideo:function(e){return K(r,e,!0,!0)},unmuteVideo:function(e){return K(r,e,!0,!1)},getBitrate:function(e){return $(r,e)},send:function(e){M(r,e)},data:function(e){L(r,e)},dtmf:function(e){V(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(r,!0,e)},createAnswer:function(e){U(r,!1,e)},handleRemoteJsep:function(e){J(r,e)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Z(r,!0===e)},detach:function(e){N(r,e)}};T[r]=o,e.success(o)},u["session_id"]=C,void r.send(JSON.stringify(u));d.httpAPICall(s+"/"+C,{verb:"POST",withCredentials:f,body:u,success:function(t){if(d.debug(t),"success"!==t["janus"])return d.error("Ooops: "+t["error"].code+" "+t["error"].reason),void e.error("Ooops: "+t["error"].code+" "+t["error"].reason);var r=t.data["id"];d.log("Created handle: "+r);var o={session:w,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(e,t){return B(r,e,!0,t)},getRemoteVolume:function(e,t){return B(r,e,!0,t)},getLocalVolume:function(e,t){return B(r,e,!1,t)},isAudioMuted:function(e){return q(r,e,!1)},muteAudio:function(e){return K(r,e,!1,!0)},unmuteAudio:function(e){return K(r,e,!1,!1)},isVideoMuted:function(e){return q(r,e,!0)},muteVideo:function(e){return K(r,e,!0,!0)},unmuteVideo:function(e){return K(r,e,!0,!1)},getBitrate:function(e){return $(r,e)},send:function(e){M(r,e)},data:function(e){L(r,e)},dtmf:function(e){V(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){U(r,!0,e)},createAnswer:function(e){U(r,!1,e)},handleRemoteJsep:function(e){J(r,e)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){Z(r,!0===e)},detach:function(e){N(r,e)}};T[r]=o,e.success(o)},error:function(t,r){d.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}function M(e,n){if(n=n||{},n.success="function"==typeof n.success?n.success:d.noop,n.error="function"==typeof n.error?n.error:d.noop,!S)return d.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o=T[e];if(!o||!o.webrtcStuff)return d.warn("Invalid handle"),void n.error("Invalid handle");var i=n.message,a=n.jsep,c=d.randomString(12),u={janus:"message",body:i,transaction:c};if(o.token&&(u["token"]=o.token),v&&(u["apisecret"]=v),a&&(u.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(u.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(u.jsep.rid_order=a.rid_order),a.force_relay&&(u.jsep.force_relay=!0)),d.debug("Sending message to plugin (handle="+e+"):"),d.debug(u),t)return u["session_id"]=C,u["handle_id"]=e,R[c]=function(e){if(d.debug("Message sent!"),d.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(!t)return d.warn("Request succeeded, but missing plugindata..."),void n.success();d.log("Synchronous transaction successful ("+t["plugin"]+")");var r=t["data"];return d.debug(r),void n.success(r)}"ack"===e["janus"]?n.success():e["error"]?(d.error("Ooops: "+e["error"].code+" "+e["error"].reason),n.error(e["error"].code+" "+e["error"].reason)):(d.error("Unknown error"),n.error("Unknown error"))},void r.send(JSON.stringify(u));d.httpAPICall(s+"/"+C+"/"+e,{verb:"POST",withCredentials:f,body:u,success:function(e){if(d.debug("Message sent!"),d.debug(e),"success"===e["janus"]){var t=e["plugindata"];if(!t)return d.warn("Request succeeded, but missing plugindata..."),void n.success();d.log("Synchronous transaction successful ("+t["plugin"]+")");var r=t["data"];return d.debug(r),void n.success(r)}"ack"===e["janus"]?n.success():e["error"]?(d.error("Ooops: "+e["error"].code+" "+e["error"].reason),n.error(e["error"].code+" "+e["error"].reason)):(d.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){d.error(e+":",t),n.error(e+": "+t)}})}function O(e,n){if(S){var o=T[e];if(o&&o.webrtcStuff){var i={janus:"trickle",candidate:n,transaction:d.randomString(12)};if(o.token&&(i["token"]=o.token),v&&(i["apisecret"]=v),d.vdebug("Sending trickle candidate (handle="+e+"):"),d.vdebug(i),t)return i["session_id"]=C,i["handle_id"]=e,void r.send(JSON.stringify(i));d.httpAPICall(s+"/"+C+"/"+e,{verb:"POST",withCredentials:f,body:i,success:function(e){d.vdebug("Candidate sent!"),d.vdebug(e),"ack"===e["janus"]||d.error("Ooops: "+e["error"].code+" "+e["error"].reason)},error:function(e,t){d.error(e+":",t)}})}else d.warn("Invalid handle")}else d.warn("Is the server down? (connected=false)")}function j(e,t,r,n,o){var i=T[e];if(i&&i.webrtcStuff){var a=i.webrtcStuff;if(a.pc){var s=function(e){d.log("Received message on data channel:",e);var t=e.target.label;i.ondata(e.data,t)},c=function(e){d.log("Received state change on data channel:",e);var t=e.target.label,r=e.target.protocol,n=a.dataChannel[t]?a.dataChannel[t].readyState:"null";if(d.log("State change on <"+t+"> data channel: "+n),"open"===n){if(a.dataChannel[t].pending&&a.dataChannel[t].pending.length>0){for(var o of(d.log("Sending pending messages on <"+t+">:",a.dataChannel[t].pending.length),a.dataChannel[t].pending))d.log("Sending data on data channel <"+t+">"),d.debug(o),a.dataChannel[t].send(o);a.dataChannel[t].pending=[]}i.ondataopen(t,r)}},u=function(e){d.error("Got error on data channel:",e)};if(n)a.dataChannel[t]=n;else{var l=a.dataChannelOptions;r&&(l.protocol=r),a.dataChannel[t]=a.pc.createDataChannel(t,l)}a.dataChannel[t].onmessage=s,a.dataChannel[t].onopen=c,a.dataChannel[t].onclose=c,a.dataChannel[t].onerror=u,a.dataChannel[t].pending=[],o&&a.dataChannel[t].pending.push(o)}else d.warn("Invalid PeerConnection")}else d.warn("Invalid handle")}function L(e,t){t=t||{},t.success="function"==typeof t.success?t.success:d.noop,t.error="function"==typeof t.error?t.error:d.noop;var r=T[e];if(!r||!r.webrtcStuff)return d.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff,o=t.text||t.data;if(!o)return d.warn("Invalid data"),void t.error("Invalid data");var i=t.label?t.label:d.dataChanDefaultLabel;return n.dataChannel[i]?"open"!==n.dataChannel[i].readyState?(n.dataChannel[i].pending.push(o),void t.success()):(d.log("Sending data on data channel <"+i+">"),d.debug(o),n.dataChannel[i].send(o),void t.success()):(j(e,i,t.protocol,!1,o,t.protocol),void t.success())}function V(e,t){t=t||{},t.success="function"==typeof t.success?t.success:d.noop,t.error="function"==typeof t.error?t.error:d.noop;var r=T[e];if(!r||!r.webrtcStuff)return d.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff;if(!n.dtmfSender){if(n.pc){var o=n.pc.getSenders(),i=o.find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return d.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=i.dtmf,n.dtmfSender&&(d.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){d.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return d.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var a=t.dtmf;if(!a)return d.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var s=a.tones;if(!s)return d.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var c="number"===typeof a.duration?a.duration:500,u="number"===typeof a.gap?a.gap:50;d.debug("Sending DTMF string "+s+" (duration "+c+"ms, gap "+u+"ms)"),n.dtmfSender.insertDTMF(s,c,u),t.success()}function N(e,n){n=n||{},n.success="function"==typeof n.success?n.success:d.noop,n.error="function"==typeof n.error?n.error:d.noop;var o=!0===n.noRequest;d.log("Destroying handle "+e+" (only-locally="+o+")"),Z(e);var i=T[e];if(!i||i.detached)return delete T[e],void n.success();if(i.detached=!0,o)return delete T[e],void n.success();if(!S)return d.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:d.randomString(12)};if(i.token&&(a["token"]=i.token),v&&(a["apisecret"]=v),t)return a["session_id"]=C,a["handle_id"]=e,r.send(JSON.stringify(a)),delete T[e],void n.success();d.httpAPICall(s+"/"+C+"/"+e,{verb:"POST",withCredentials:f,body:a,success:function(t){d.log("Destroyed handle:"),d.debug(t),"success"!==t["janus"]&&d.error("Ooops: "+t["error"].code+" "+t["error"].reason),delete T[e],n.success()},error:function(t,r){d.error(t+":",r),delete T[e],n.success()}})}function F(e,t,r,n,o){var i=T[e];if(!i||!i.webrtcStuff)return d.warn("Invalid handle"),n.stream||d.stopAllTracks(o),void n.error("Invalid handle");var a=i.webrtcStuff;d.debug("streamsDone:",o),o&&(d.debug("  -- Audio tracks:",o.getAudioTracks()),d.debug("  -- Video tracks:",o.getVideoTracks()));var s=!1;if(a.myStream&&r.update&&(!a.streamExternal||r.replaceAudio||r.replaceVideo)){if((!r.update&&Q(r)||r.update&&(r.addAudio||r.replaceAudio))&&o.getAudioTracks()&&o.getAudioTracks().length)if(a.myStream.addTrack(o.getAudioTracks()[0]),d.unifiedPlan){d.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]);var f=null;const e=a.pc.getTransceivers();if(e&&e.length>0)for(const t of e)if(t.sender&&t.sender.track&&"audio"===t.sender.track.kind||t.receiver&&t.receiver.track&&"audio"===t.receiver.track.kind){f=t;break}f&&f.sender?f.sender.replaceTrack(o.getAudioTracks()[0]):a.pc.addTrack(o.getAudioTracks()[0],o)}else d.log((r.replaceAudio?"Replacing":"Adding")+" audio track:",o.getAudioTracks()[0]),a.pc.addTrack(o.getAudioTracks()[0],o);if((!r.update&&te(r)||r.update&&(r.addVideo||r.replaceVideo))&&o.getVideoTracks()&&o.getVideoTracks().length)if(a.myStream.addTrack(o.getVideoTracks()[0]),d.unifiedPlan){d.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]);var m=null;const e=a.pc.getTransceivers();if(e&&e.length>0)for(const t of e)if(t.sender&&t.sender.track&&"video"===t.sender.track.kind||t.receiver&&t.receiver.track&&"video"===t.receiver.track.kind){m=t;break}m&&m.sender?m.sender.replaceTrack(o.getVideoTracks()[0]):a.pc.addTrack(o.getVideoTracks()[0],o)}else d.log((r.replaceVideo?"Replacing":"Adding")+" video track:",o.getVideoTracks()[0]),a.pc.addTrack(o.getVideoTracks()[0],o)}else a.myStream=o,s=!0;if(!a.pc){var h={iceServers:c,iceTransportPolicy:u,bundlePolicy:l};"chrome"===d.webRTCAdapter.browserDetails.browser&&(h["sdpSemantics"]=d.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var v={optional:[{DtlsSrtpKeyAgreement:!0}]};if(p&&v.optional.push({googIPv6:!0}),n.rtcConstraints&&"object"===typeof n.rtcConstraints)for(var g in d.debug("Adding custom PeerConnection constraints:",n.rtcConstraints),n.rtcConstraints)v.optional.push(n.rtcConstraints[g]);"edge"===d.webRTCAdapter.browserDetails.browser&&(h.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(n.senderTransforms||n.receiverTransforms)&&(a.senderTransforms=n.senderTransforms,a.receiverTransforms=n.receiverTransforms,h["forceEncodedAudioInsertableStreams"]=!0,h["forceEncodedVideoInsertableStreams"]=!0,h["encodedInsertableStreams"]=!0),d.log("Creating PeerConnection"),d.debug(v),a.pc=new RTCPeerConnection(h,v),d.debug(a.pc),a.pc.getStats&&(a.volume={},a.bitrate.value="0 kbits/sec"),d.log("Preparing local SDP and gathering candidates (trickle="+a.trickle+")"),a.pc.oniceconnectionstatechange=function(){a.pc&&i.iceState(a.pc.iceConnectionState)},a.pc.onicecandidate=function(t){if(!t.candidate||"edge"===d.webRTCAdapter.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)d.log("End of candidates."),a.iceDone=!0,!0===a.trickle?O(e,{completed:!0}):W(e,n);else{var r={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===a.trickle&&O(e,r)}},a.pc.ontrack=function(e){if(d.log("Handling Remote Track"),d.debug(e),e.streams&&(a.remoteStream=e.streams[0],e.track)){var t=e.transceiver?e.transceiver.mid:e.track.id;try{i.onremotetrack(e.track,t,!0)}catch(o){d.error(o)}if(!e.track.onended){if(a.receiverTransforms){var r=null;RTCRtpSender.prototype.createEncodedStreams?r=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&a.receiverTransforms["audio"]?r=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&a.receiverTransforms["video"]&&(r=e.receiver.createEncodedVideoStreams())),r&&(console.log(r),r.readableStream&&r.writableStream?r.readableStream.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(r.writableStream):r.readable&&r.writable&&r.readable.pipeThrough(a.receiverTransforms[e.track.kind]).pipeTo(r.writable))}var n=null;d.log("Adding onended callback to track:",e.track),e.track.onended=function(e){if(d.log("Remote track removed:",e),a.remoteStream){clearTimeout(n),a.remoteStream.removeTrack(e.target);var t=e.target.id;if(d.unifiedPlan){var r=a.pc.getTransceivers().find((t=>t.receiver.track===e.target));t=r.mid}try{i.onremotetrack(e.target,t,!1)}catch(o){d.error(o)}}},e.track.onmute=function(e){d.log("Remote track muted:",e),a.remoteStream&&null==n&&(n=setTimeout((function(){if(d.log("Removing remote track"),a.remoteStream){a.remoteStream.removeTrack(e.target);var t=e.target.id;if(d.unifiedPlan){var r=a.pc.getTransceivers().find((t=>t.receiver.track===e.target));t=r.mid}try{i.onremotetrack(e.target,t,!1)}catch(o){d.error(o)}}n=null}),2520))},e.track.onunmute=function(e){if(d.log("Remote track flowing again:",e),null!=n)clearTimeout(n),n=null;else try{a.remoteStream.addTrack(e.target);var t=e.target.id;if(d.unifiedPlan){var r=a.pc.getTransceivers().find((t=>t.receiver.track===e.target));t=r.mid}i.onremotetrack(e.target,t,!0)}catch(o){d.error(o)}}}}}}if(s&&o){d.log("Adding local stream");var y=(!0===n.simulcast||!0===n.simulcast2)&&d.unifiedPlan,S=n.svc;o.getTracks().forEach((function(e){d.log("Adding local track:",e);var t=null;if(!y&&!S||"audio"===e.kind)t=a.pc.addTrack(e,o);else if(y){d.log("Enabling rid-based simulcasting:",e);let r=b(n.simulcastMaxBitrates),i=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:n.sendEncodings||[{rid:"h",active:!0,maxBitrate:r.high},{rid:"m",active:!0,maxBitrate:r.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:r.low,scaleResolutionDownBy:4}]});i&&(t=i.sender)}else{d.log("Enabling SVC ("+S+"):",e);let r=a.pc.addTransceiver(e,{direction:"sendrecv",streams:[o],sendEncodings:[{scalabilityMode:S}]});r&&(t=r.sender)}if(t&&a.senderTransforms){var r=null;RTCRtpSender.prototype.createEncodedStreams?r=t.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===t.track.kind&&a.senderTransforms["audio"]?r=t.createEncodedAudioStreams():"video"===t.track.kind&&a.senderTransforms["video"]&&(r=t.createEncodedVideoStreams())),r&&(console.log(r),r.readableStream&&r.writableStream?r.readableStream.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(r.writableStream):r.readable&&r.writable&&r.readable.pipeThrough(a.senderTransforms[t.track.kind]).pipeTo(r.writable))}}))}if(ie(r)&&!a.dataChannel[d.dataChanDefaultLabel]&&(d.log("Creating default data channel"),j(e,d.dataChanDefaultLabel,null,!1),a.pc.ondatachannel=function(t){d.log("Data channel created by Janus:",t),j(e,t.channel.label,t.channel.protocol,t.channel)}),a.myStream){var C=a.myStream.getTracks();for(let e in C){var w=C[e];w.onended=function(e){d.log("Local track removed:",e);try{i.onlocaltrack(e.target,!1)}catch(t){d.error(t)}};try{i.onlocaltrack(w,!0)}catch(k){d.error(k)}}}t?a.pc.setRemoteDescription(t).then((function(){if(d.log("Remote description accepted!"),a.remoteSdp=t.sdp,a.candidates&&a.candidates.length>0){for(var o=0;o<a.candidates.length;o++){var i=a.candidates[o];d.debug("Adding remote candidate:",i),i&&!0!==i.completed?a.pc.addIceCandidate(i):a.pc.addIceCandidate(d.endOfCandidates)}a.candidates=[]}z(e,r,n)}),n.error):G(e,r,n)}function U(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:d.noop,r.error="function"==typeof r.error?r.error:H;var n=r.jsep;if(t&&n)return d.error("Provided a JSEP to a createOffer"),void r.error("Provided a JSEP to a createOffer");if(!t&&(!n||!n.type||!n.sdp))return d.error("A valid JSEP is required for createAnswer"),void r.error("A valid JSEP is required for createAnswer");r.media="object"===typeof r.media&&r.media?r.media:{audio:!0,video:!0};var o=r.media,i=T[e];if(!i||!i.webrtcStuff)return d.warn("Invalid handle"),void r.error("Invalid handle");var a=i.webrtcStuff;if(a.trickle=ae(r.trickle),a.pc){if(d.log("Updating existing media session"),o.update=!0,r.stream)r.stream!==a.myStream&&d.log("Renegotiation involves a new external stream");else{if(o.addAudio){if(o.keepAudio=!1,o.replaceAudio=!1,o.removeAudio=!1,o.audioSend=!0,a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length)return d.error("Can't add audio stream, there already is one"),void r.error("Can't add audio stream, there already is one")}else o.removeAudio?(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!1,o.audioSend=!1):o.replaceAudio&&(o.keepAudio=!1,o.addAudio=!1,o.removeAudio=!1,o.audioSend=!0);if(a.myStream&&a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!Q(o)||o.removeAudio||o.replaceAudio||(o.keepAudio=!0):(o.replaceAudio&&(o.keepAudio=!1,o.replaceAudio=!1,o.addAudio=!0,o.audioSend=!0),Q(o)&&(o.keepAudio=!1,o.addAudio=!0)),o.addVideo){if(o.keepVideo=!1,o.replaceVideo=!1,o.removeVideo=!1,o.videoSend=!0,a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length)return d.error("Can't add video stream, there already is one"),void r.error("Can't add video stream, there already is one")}else o.removeVideo?(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!1,o.videoSend=!1):o.replaceVideo&&(o.keepVideo=!1,o.addVideo=!1,o.removeVideo=!1,o.videoSend=!0);a.myStream&&a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!te(o)||o.removeVideo||o.replaceVideo||(o.keepVideo=!0):(o.replaceVideo&&(o.keepVideo=!1,o.replaceVideo=!1,o.addVideo=!0,o.videoSend=!0),te(o)&&(o.keepVideo=!1,o.addVideo=!0)),o.addData&&(o.data=!0)}if(Q(o)&&o.keepAudio&&te(o)&&o.keepVideo)return i.consentDialog(!1),void F(e,n,o,r,a.myStream)}else o.update=!1,o.keepAudio=!1,o.keepVideo=!1;if(o.update&&(!a.streamExternal||a.streamExternal&&(o.replaceAudio||o.replaceVideo))){if(o.removeAudio||o.replaceAudio){if(a.myStream&&a.myStream.getAudioTracks()&&a.myStream.getAudioTracks().length){var s=a.myStream.getAudioTracks()[0];d.log("Removing audio track:",s),a.myStream.removeTrack(s);try{i.onlocaltrack(s,!1)}catch(P){d.error(P)}try{s.stop()}catch(P){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var c=!0;if(o.replaceAudio&&d.unifiedPlan&&(c=!1),c)for(var u of a.pc.getSenders())u&&u.track&&"audio"===u.track.kind&&(d.log("Removing audio sender:",u),a.pc.removeTrack(u))}}if(o.removeVideo||o.replaceVideo){if(a.myStream&&a.myStream.getVideoTracks()&&a.myStream.getVideoTracks().length){var l=a.myStream.getVideoTracks()[0];d.log("Removing video track:",l),a.myStream.removeTrack(l);try{i.onlocaltrack(l,!1)}catch(P){d.error(P)}try{l.stop()}catch(P){}}if(a.pc.getSenders()&&a.pc.getSenders().length){var p=!0;if(o.replaceVideo&&d.unifiedPlan&&(p=!1),p)for(var f of a.pc.getSenders())f&&f.track&&"video"===f.track.kind&&(d.log("Removing video sender:",f),a.pc.removeTrack(f))}}}if(r.stream){var m=r.stream;return d.log("MediaStream provided by the application"),d.debug(m),!o.update||!a.myStream||a.myStream===r.stream||a.streamExternal||o.replaceAudio||o.replaceVideo||(d.stopAllTracks(a.myStream),a.myStream=null),a.streamExternal=!0,i.consentDialog(!1),void F(e,n,o,r,m)}if(Q(o)||te(o)){if(!d.isGetUserMediaAvailable())return void r.error("getUserMedia not available");var h={mandatory:{},optional:[]};i.consentDialog(!0);var v=Q(o);v&&o&&"object"===typeof o.audio&&(v=o.audio);var g=te(o);if(g&&o){var y=!0===r.simulcast||!0===r.simulcast2,b=r.svc;if(!y&&!b||n||o.video||(o.video="hires"),o.video&&"screen"!=o.video&&"window"!=o.video)if("object"===typeof o.video)g=o.video;else{var S=0,C=0;"lowres"===o.video?(C=240,S=320):"lowres-16:9"===o.video?(C=180,S=320):"hires"===o.video||"hires-16:9"===o.video||"hdres"===o.video?(C=720,S=1280):"fhdres"===o.video?(C=1080,S=1920):"4kres"===o.video?(C=2160,S=3840):"stdres"===o.video?(C=480,S=640):"stdres-16:9"===o.video?(C=360,S=640):(d.log("Default video setting is stdres 4:3"),C=480,S=640),d.log("Adding media constraint:",o.video),g={height:{ideal:C},width:{ideal:S}},d.log("Adding video constraint:",g)}else if("screen"===o.video||"window"===o.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return h.video={},o.screenshareFrameRate&&(h.video.frameRate=o.screenshareFrameRate),o.screenshareHeight&&(h.video.height=o.screenshareHeight),o.screenshareWidth&&(h.video.width=o.screenshareWidth),h.audio=o.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(h).then((function(t){i.consentDialog(!1),Q(o)&&!o.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){t.addTrack(i.getAudioTracks()[0]),F(e,n,o,r,t)})):F(e,n,o,r,t)}),(function(e){i.consentDialog(!1),r.error(e)}));const t=function(t,a){i.consentDialog(!1),t?r.error(t):F(e,n,o,r,a)},a=function(e,t,r){d.log("Adding media constraint (screen capture)"),d.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){r?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(r){e.addTrack(r.getAudioTracks()[0]),t(null,e)})):t(null,e)})).catch((function(e){i.consentDialog(!1),t(e)}))};if("chrome"===d.webRTCAdapter.browserDetails.browser){var w=d.webRTCAdapter.browserDetails.version,k=33;window.navigator.userAgent.match("Linux")&&(k=35),w>=26&&w<=k?(h={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate,chromeMediaSource:"screen"}},audio:Q(o)&&!o.keepAudio},a(h,t)):d.extension.getScreen((function(e,n){if(e)return i.consentDialog(!1),r.error(e);h={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:o.screenshareFrameRate,maxFrameRate:o.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},h.video.mandatory.chromeMediaSourceId=n,a(h,t,Q(o)&&!o.keepAudio)}))}else if("firefox"===d.webRTCAdapter.browserDetails.browser){if(!(d.webRTCAdapter.browserDetails.version>=33)){var R=new Error("NavigatorUserMediaError");return R.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",i.consentDialog(!1),void r.error(R)}h={video:{mozMediaSource:o.video,mediaSource:o.video},audio:Q(o)&&!o.keepAudio},a(h,(function(e,r){if(t(e,r),!e)var n=r.currentTime,o=window.setInterval((function(){r||window.clearInterval(o),r.currentTime==n&&(window.clearInterval(o),r.onended&&r.onended()),n=r.currentTime}),500)}))}return}}o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then((function(t){var a=t.some((function(e){return"audioinput"===e.kind})),s=oe(o)||t.some((function(e){return"videoinput"===e.kind})),c=Q(o),u=te(o),l=X(o),p=re(o);if(c||u||l||p){var f=!!c&&a,h=!!u&&s;if(!f&&!h)return i.consentDialog(!1),r.error("No capture device found"),!1;if(!f&&l)return i.consentDialog(!1),r.error("Audio capture is required, but no capture device found"),!1;if(!h&&p)return i.consentDialog(!1),r.error("Video capture is required, but no capture device found"),!1}var y={audio:!(!a||o.keepAudio)&&v,video:!(!s||o.keepVideo)&&g};d.debug("getUserMedia constraints",y),y.audio||y.video?navigator.mediaDevices.getUserMedia(y).then((function(t){i.consentDialog(!1),F(e,n,o,r,t)})).catch((function(e){i.consentDialog(!1),r.error({code:e.code,name:e.name,message:e.message})})):(i.consentDialog(!1),F(e,n,o,r,m))})).catch((function(e){i.consentDialog(!1),r.error(e)}))}else F(e,n,o,r)}function J(e,t){t=t||{},t.success="function"==typeof t.success?t.success:d.noop,t.error="function"==typeof t.error?t.error:H,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:d.noop;var r=t.jsep,n=T[e];if(!n||!n.webrtcStuff)return d.warn("Invalid handle"),void t.error("Invalid handle");var o=n.webrtcStuff;if(r){if(!o.pc)return d.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(r),o.pc.setRemoteDescription(r).then((function(){if(d.log("Remote description accepted!"),o.remoteSdp=r.sdp,o.candidates&&o.candidates.length>0){for(var e=0;e<o.candidates.length;e++){var n=o.candidates[e];d.debug("Adding remote candidate:",n),n&&!0!==n.completed?o.pc.addIceCandidate(n):o.pc.addIceCandidate(d.endOfCandidates)}o.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function G(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:d.noop,r.error="function"==typeof r.error?r.error:d.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:d.noop;var n=T[e];if(!n||!n.webrtcStuff)return d.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,i=!0===r.simulcast||!0===r.simulcast2;i?d.log("Creating offer (iceDone="+o.iceDone+", simulcast="+i+")"):d.log("Creating offer (iceDone="+o.iceDone+")");var a={};if(d.unifiedPlan){var s=null,c=null,u=o.pc.getTransceivers();if(u&&u.length>0)for(var l of u)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(c||(c=l));var p=Q(t),f=ee(t);p||f?p&&f?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",d.log("Setting audio transceiver to sendrecv:",s)):p&&!f?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",d.log("Setting audio transceiver to sendonly:",s)):!p&&f&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",d.log("Setting audio transceiver to recvonly:",s)):(s=o.pc.addTransceiver("audio",{direction:"recvonly"}),d.log("Adding recvonly audio transceiver:",s))):t.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",d.log("Setting audio transceiver to inactive:",s));var m=te(t),h=ne(t);m||h?m&&h?c&&(c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",d.log("Setting video transceiver to sendrecv:",c)):m&&!h?c&&(c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",d.log("Setting video transceiver to sendonly:",c)):!m&&h&&(c?(c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",d.log("Setting video transceiver to recvonly:",c)):(c=o.pc.addTransceiver("video",{direction:"recvonly"}),d.log("Adding recvonly video transceiver:",c))):t.removeVideo&&c&&(c.setDirection?c.setDirection("inactive"):c.direction="inactive",d.log("Setting video transceiver to inactive:",c))}else a["offerToReceiveAudio"]=ee(t),a["offerToReceiveVideo"]=ne(t);var v=!0===r.iceRestart;v&&(a["iceRestart"]=!0),d.debug(a);var g=te(t);if(g&&i&&"firefox"===d.webRTCAdapter.browserDetails.browser){d.log("Enabling Simulcasting for Firefox (RID)");var y=o.pc.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(y){var S=y.getParameters();S||(S={});var C=b(r.simulcastMaxBitrates);S.encodings=r.sendEncodings||[{rid:"h",active:!0,maxBitrate:C.high},{rid:"m",active:!0,maxBitrate:C.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:C.low,scaleResolutionDownBy:4}],y.setParameters(S)}}o.pc.createOffer(a).then((function(e){d.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,d.log("Setting local description"),g&&i&&!d.unifiedPlan&&("chrome"!==d.webRTCAdapter.browserDetails.browser&&"safari"!==d.webRTCAdapter.browserDetails.browser||(d.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=Y(e.sdp))),o.mySdp={type:"offer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=a,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e["e2ee"]=!0),r.success(e)):d.log("Waiting for all candidates...")}),r.error)}function z(e,t,r){r=r||{},r.success="function"==typeof r.success?r.success:d.noop,r.error="function"==typeof r.error?r.error:d.noop,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:d.noop;var n=T[e];if(!n||!n.webrtcStuff)return d.warn("Invalid handle"),void r.error("Invalid handle");var o=n.webrtcStuff,i=!0===r.simulcast||!0===r.simulcast2;i?d.log("Creating answer (iceDone="+o.iceDone+", simulcast="+i+")"):d.log("Creating answer (iceDone="+o.iceDone+")");var a=null;if(d.unifiedPlan){a={};var s=null,c=null,u=o.pc.getTransceivers();if(u&&u.length>0)for(var l of u)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(c||(c=l));var p=Q(t),f=ee(t);if(p||f){if(p&&f){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",d.log("Setting audio transceiver to sendrecv:",s)}catch(C){d.error(C)}}else if(p&&!f)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",d.log("Setting audio transceiver to sendonly:",s))}catch(C){d.error(C)}else if(!p&&f)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",d.log("Setting audio transceiver to recvonly:",s)}catch(C){d.error(C)}else s=o.pc.addTransceiver("audio",{direction:"recvonly"}),d.log("Adding recvonly audio transceiver:",s)}else if(t.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",d.log("Setting audio transceiver to inactive:",s)}catch(C){d.error(C)}var m=te(t),h=ne(t);if(m||h){if(m&&h){if(c)try{c.setDirection?c.setDirection("sendrecv"):c.direction="sendrecv",d.log("Setting video transceiver to sendrecv:",c)}catch(C){d.error(C)}}else if(m&&!h){if(c)try{c.setDirection?c.setDirection("sendonly"):c.direction="sendonly",d.log("Setting video transceiver to sendonly:",c)}catch(C){d.error(C)}}else if(!m&&h)if(c)try{c.setDirection?c.setDirection("recvonly"):c.direction="recvonly",d.log("Setting video transceiver to recvonly:",c)}catch(C){d.error(C)}else c=o.pc.addTransceiver("video",{direction:"recvonly"}),d.log("Adding recvonly video transceiver:",c)}else if(t.removeVideo&&c)try{c.setDirection?c.setDirection("inactive"):c.direction="inactive",d.log("Setting video transceiver to inactive:",c)}catch(C){d.error(C)}}else a="firefox"===d.webRTCAdapter.browserDetails.browser||"edge"===d.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:ee(t),offerToReceiveVideo:ne(t)}:{mandatory:{OfferToReceiveAudio:ee(t),OfferToReceiveVideo:ne(t)}};d.debug(a);var v=te(t);if(v&&i&&"firefox"===d.webRTCAdapter.browserDetails.browser){d.log("Enabling Simulcasting for Firefox (RID)");var g=o.pc.getSenders()[1];d.log(g);var y=g.getParameters();d.log(y);var S=b(r.simulcastMaxBitrates);g.setParameters({encodings:r.sendEncodings||[{rid:"h",active:!0,maxBitrate:S.high},{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:S.low,scaleResolutionDownBy:4}]})}o.pc.createAnswer(a).then((function(e){d.debug(e);var t={type:e.type,sdp:e.sdp};r.customizeSdp(t),e.sdp=t.sdp,d.log("Setting local description"),v&&i&&!d.unifiedPlan&&"chrome"===d.webRTCAdapter.browserDetails.browser&&d.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"),o.mySdp={type:"answer",sdp:e.sdp},o.pc.setLocalDescription(e).catch(r.error),o.mediaConstraints=a,o.iceDone||o.trickle?((o.senderTransforms||o.receiverTransforms)&&(e["e2ee"]=!0),r.success(e)):d.log("Waiting for all candidates...")}),r.error)}function W(e,t){t=t||{},t.success="function"==typeof t.success?t.success:d.noop,t.error="function"==typeof t.error?t.error:d.noop;var r=T[e];if(r&&r.webrtcStuff){var n=r.webrtcStuff;d.log("Sending offer/answer SDP..."),n.mySdp?(n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp["trickle"]=!1),d.debug(t),n.sdpSent=!0,t.success(n.mySdp)):d.warn("Local SDP instance is invalid, not sending anything...")}else d.warn("Invalid handle, not sending anything")}function B(e,t,r,n){n="function"==typeof n?n:d.noop;var o=T[e];if(!o||!o.webrtcStuff)return d.warn("Invalid handle"),void n(0);var i=r?"remote":"local",a=o.webrtcStuff;if(a.volume[i]||(a.volume[i]={value:0}),!a.pc.getStats||"chrome"!==d.webRTCAdapter.browserDetails.browser&&"safari"!==d.webRTCAdapter.browserDetails.browser)return d.warn("Getting the "+i+" volume unsupported by browser"),void n(0);if(r&&!a.remoteStream)return d.warn("Remote stream unavailable"),void n(0);if(!r&&!a.myStream)return d.warn("Local stream unavailable"),void n(0);var s=a.pc;if(t&&d.unifiedPlan){var c=a.pc.getTransceivers().find((e=>e.mid===t&&"audio"===e.receiver.track.kind));if(!c)return d.warn("No audio transceiver with mid "+t),void n(0);if(r&&!c.receiver)return d.warn("Remote transceiver track unavailable"),void n(0);if(!r&&!c.sender)return d.warn("Local transceiver track unavailable"),void n(0);s=r?c.receiver:c.sender}return s.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||n(e.audioLevel?e.audioLevel:0))}))})),a.volume[i].value}function q(e,t,r){var n=T[e];if(!n||!n.webrtcStuff)return d.warn("Invalid handle"),!0;var o=n.webrtcStuff;if(!o.pc)return d.warn("Invalid PeerConnection"),!0;if(!o.myStream)return d.warn("Invalid local MediaStream"),!0;if(r){if(!o.myStream.getVideoTracks()||0===o.myStream.getVideoTracks().length)return d.warn("No video track"),!0;if(t&&d.unifiedPlan){let e=o.pc.getTransceivers().find((e=>e.mid===t&&"video"===e.receiver.track.kind));return e?e.sender&&e.sender.track?!e.sender.track.enabled:(d.warn("No video sender with mid "+t),!0):(d.warn("No video transceiver with mid "+t),!0)}return!o.myStream.getVideoTracks()[0].enabled}if(!o.myStream.getAudioTracks()||0===o.myStream.getAudioTracks().length)return d.warn("No audio track"),!0;if(t&&d.unifiedPlan){let e=o.pc.getTransceivers().find((e=>e.mid===t&&"audio"===e.receiver.track.kind));return e?e.sender&&e.sender.track?!e.sender.track.enabled:(d.warn("No audio sender with mid "+t),!0):(d.warn("No audio transceiver with mid "+t),!0)}return!o.myStream.getAudioTracks()[0].enabled}function K(e,t,r,n){var o=T[e];if(!o||!o.webrtcStuff)return d.warn("Invalid handle"),!1;var i=o.webrtcStuff;if(!i.pc)return d.warn("Invalid PeerConnection"),!1;if(!i.myStream)return d.warn("Invalid local MediaStream"),!1;if(r){if(!i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length)return d.warn("No video track"),!1;if(t&&d.unifiedPlan){let e=i.pc.getTransceivers().find((e=>e.mid===t&&"video"===e.receiver.track.kind));if(!e)return d.warn("No video transceiver with mid "+t),!1;if(!e.sender||!e.sender.track)return d.warn("No video sender with mid "+t),!1;e.sender.track.enabled=!n}else i.myStream.getVideoTracks()[0].enabled=!n}else{if(!i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length)return d.warn("No audio track"),!1;if(t&&d.unifiedPlan){let e=i.pc.getTransceivers().find((e=>e.mid===t&&"audio"===e.receiver.track.kind));if(!e)return d.warn("No audio transceiver with mid "+t),!1;if(!e.sender||!e.sender.track)return d.warn("No audio sender with mid "+t),!1;e.sender.track.enabled=!n}else i.myStream.getAudioTracks()[0].enabled=!n}return!0}function $(e,t){var r=T[e];if(!r||!r.webrtcStuff)return d.warn("Invalid handle"),"Invalid handle";var n=r.webrtcStuff;if(!n.pc)return"Invalid PeerConnection";if(n.pc.getStats){var o=n.pc,i=t||"default";if(t&&d.unifiedPlan){var a=n.pc.getTransceivers().find((e=>e.mid===t&&"video"===e.receiver.track.kind));if(!a)return d.warn("No video transceiver with mid "+t),"No video transceiver with mid "+t;if(!a.receiver)return d.warn("No video receiver with mid "+t),"No video receiver with mid "+t;o=a.receiver}return n.bitrate[i]||(n.bitrate[i]={timer:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,value:"0 kbits/sec"}),n.bitrate[i].timer?n.bitrate[i].value:(d.log("Starting bitrate timer"+(t?" for mid "+t:"")+" (via getStats)"),n.bitrate[i].timer=setInterval((function(){o.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate[i].bsnow=e.bytesReceived,n.bitrate[i].tsnow=e.timestamp,null===n.bitrate[i].bsbefore||null===n.bitrate[i].tsbefore)n.bitrate[i].bsbefore=n.bitrate[i].bsnow,n.bitrate[i].tsbefore=n.bitrate[i].tsnow;else{var r=n.bitrate[i].tsnow-n.bitrate[i].tsbefore;"safari"===d.webRTCAdapter.browserDetails.browser&&(r/=1e3);var o=Math.round(8*(n.bitrate[i].bsnow-n.bitrate[i].bsbefore)/r);"safari"===d.webRTCAdapter.browserDetails.browser&&(o=parseInt(o/1e3)),n.bitrate[i].value=o+" kbits/sec",n.bitrate[i].bsbefore=n.bitrate[i].bsnow,n.bitrate[i].tsbefore=n.bitrate[i].tsnow}}}))}))}),1e3),"0 kbits/sec")}return d.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function H(e){d.error("WebRTC error:",e)}function Z(e,n){d.log("Cleaning WebRTC stuff");var o=T[e];if(o){var i=o.webrtcStuff;if(i){if(!0===n){var a={janus:"hangup",transaction:d.randomString(12)};o.token&&(a["token"]=o.token),v&&(a["apisecret"]=v),d.debug("Sending hangup request (handle="+e+"):"),d.debug(a),t?(a["session_id"]=C,a["handle_id"]=e,r.send(JSON.stringify(a))):d.httpAPICall(s+"/"+C+"/"+e,{verb:"POST",withCredentials:f,body:a})}for(var c in i.remoteStream=null,i.volume&&(i.volume["local"]&&i.volume["local"].timer&&clearInterval(i.volume["local"].timer),i.volume["remote"]&&i.volume["remote"].timer&&clearInterval(i.volume["remote"].timer)),i.bitrate)i.bitrate[c].timer&&clearInterval(i.bitrate[c].timer);i.bitrate={},!i.streamExternal&&i.myStream&&(d.log("Stopping local stream tracks"),d.stopAllTracks(i.myStream)),i.streamExternal=!1,i.myStream=null;try{i.pc.close()}catch(u){}i.pc=null,i.candidates=null,i.mySdp=null,i.remoteSdp=null,i.iceDone=!1,i.dataChannel={},i.dtmfSender=null,i.senderTransforms=null,i.receiverTransforms=null}o.oncleanup()}}function Y(e){var t=e.split("\r\n"),r=!1,n=[-1],o=[-1],i=null,a=null,s=null,c=null,u=-1;for(let v=0;v<t.length;v++){const m=t[v].match(/m=(\w+) */);if(m){const e=m[1];if("video"===e){if(!(n[0]<0)){u=v;break}r=!0}else if(n[0]>-1){u=v;break}}else if(r){var l=t[v].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/);if(l)return d.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var p=t[v].match(/a=ssrc-group:FID (\d+) (\d+)/);if(p)n[0]=p[1],o[0]=p[2],t.splice(v,1),v--;else{if(n[0]){var f=t[v].match("a=ssrc:"+n[0]+" cname:(.+)");if(f&&(i=f[1]),f=t[v].match("a=ssrc:"+n[0]+" msid:(.+)"),f&&(a=f[1]),f=t[v].match("a=ssrc:"+n[0]+" mslabel:(.+)"),f&&(s=f[1]),f=t[v].match("a=ssrc:"+n[0]+" label:(.+)"),f&&(c=f[1]),0===t[v].indexOf("a=ssrc:"+o[0])){t.splice(v,1),v--;continue}if(0===t[v].indexOf("a=ssrc:"+n[0])){t.splice(v,1),v--;continue}}0!=t[v].length||(t.splice(v,1),v--)}}}if(n[0]<0){u=-1,r=!1;for(let e=0;e<t.length;e++){const d=t[e].match(/m=(\w+) */);if(d){const t=d[1];if("video"===t){if(!(n[0]<0)){u=e;break}r=!0}else if(n[0]>-1){u=e;break}}else if(r){if(n[0]<0){var m=t[e].match(/a=ssrc:(\d+)/);if(m){n[0]=m[1],t.splice(e,1),e--;continue}}else{let r=t[e].match("a=ssrc:"+n[0]+" cname:(.+)");if(r&&(i=r[1]),r=t[e].match("a=ssrc:"+n[0]+" msid:(.+)"),r&&(a=r[1]),r=t[e].match("a=ssrc:"+n[0]+" mslabel:(.+)"),r&&(s=r[1]),r=t[e].match("a=ssrc:"+n[0]+" label:(.+)"),r&&(c=r[1]),0===t[e].indexOf("a=ssrc:"+o[0])){t.splice(e,1),e--;continue}if(0===t[e].indexOf("a=ssrc:"+n[0])){t.splice(e,1),e--;continue}}0!==t[e].length||(t.splice(e,1),e--)}}}if(n[0]<0)return d.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;u<0&&(u=t.length),n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random()),o[1]=Math.floor(4294967295*Math.random()),o[2]=Math.floor(4294967295*Math.random());for(var h=0;h<n.length;h++)i&&(t.splice(u,0,"a=ssrc:"+n[h]+" cname:"+i),u++),a&&(t.splice(u,0,"a=ssrc:"+n[h]+" msid:"+a),u++),s&&(t.splice(u,0,"a=ssrc:"+n[h]+" mslabel:"+s),u++),c&&(t.splice(u,0,"a=ssrc:"+n[h]+" label:"+c),u++),i&&(t.splice(u,0,"a=ssrc:"+o[h]+" cname:"+i),u++),a&&(t.splice(u,0,"a=ssrc:"+o[h]+" msid:"+a),u++),s&&(t.splice(u,0,"a=ssrc:"+o[h]+" mslabel:"+s),u++),c&&(t.splice(u,0,"a=ssrc:"+o[h]+" label:"+c),u++);return t.splice(u,0,"a=ssrc-group:FID "+n[2]+" "+o[2]),t.splice(u,0,"a=ssrc-group:FID "+n[1]+" "+o[1]),t.splice(u,0,"a=ssrc-group:FID "+n[0]+" "+o[0]),t.splice(u,0,"a=ssrc-group:SIM "+n[0]+" "+n[1]+" "+n[2]),e=t.join("\r\n"),e.endsWith("\r\n")||(e+="\r\n"),e}function Q(e){return d.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function X(e){return d.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function ee(e){return d.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function te(e){return d.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function re(e){return d.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function ne(e){return d.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function oe(e){if(d.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!==typeof e.video||"object"!==typeof e.video.mandatory)return!1;var t=e.video.mandatory;return t.chromeMediaSource?"desktop"===t.chromeMediaSource||"screen"===t.chromeMediaSource:t.mozMediaSource?"window"===t.mozMediaSource||"screen"===t.mozMediaSource:!!t.mediaSource&&("window"===t.mediaSource||"screen"===t.mediaSource)}function ie(e){return d.debug("isDataEnabled:",e),"edge"===d.webRTCAdapter.browserDetails.browser?(d.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function ae(e){return d.debug("isTrickleEnabled:",e),!1!==e}A(e),this.getServer=function(){return s},this.isConnected=function(){return S},this.reconnect=function(e){e=e||{},e.success="function"==typeof e.success?e.success:d.noop,e.error="function"==typeof e.error?e.error:d.noop,e["reconnect"]=!0,A(e)},this.getSessionId=function(){return C},this.getInfo=function(e){_(e)},this.destroy=function(e){I(e)},this.attach=function(e){x(e)}}d.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||c,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||s,httpAPICall:function(e,n){var o={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(o.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(o.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(o.body=JSON.stringify(n.body));var i=t(e,o).catch((function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var a=new r((function(e,t){var r=setTimeout((function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));i=r.race([i,a])}return i.then((function(e){return e.ok?typeof n.success===typeof d.noop?e.json().then((function(e){try{n.success(e)}catch(t){d.error("Unhandled httpAPICall success callback error",t)}}),(function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:r.reject({message:"API call failed",response:e})})).catch((function(e){typeof n.error===typeof d.noop&&n.error(e.message||"<< internal error >>",e)})),i}}},d.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||c,webRTCAdapter:e&&e.adapter||s,httpAPICall:function(e,r){var n=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},o=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return t.ajax(t.extend(n,o,{url:e,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(e){typeof r.success===typeof d.noop&&r.success(e)},error:function(e,t,n){typeof r.error===typeof d.noop&&r.error(t,n)}}))}}},d.noop=function(){},d.dataChanDefaultLabel="JanusDataChannel",d.endOfCandidates=null,d.stopAllTracks=function(e){try{var t=e.getTracks();for(var r of t)d.log(r),r&&r.stop()}catch(n){}},d.init=function(e){if(e=e||{},e.callback="function"==typeof e.callback?e.callback:d.noop,d.initDone)e.callback();else{if("undefined"==typeof console.log&&(console.log=function(){}),d.trace=d.noop,d.debug=d.noop,d.vdebug=d.noop,d.log=d.noop,d.warn=d.noop,d.error=d.noop,!0===e.debug||"all"===e.debug)d.trace=console.trace.bind(console),d.debug=console.debug.bind(console),d.vdebug=console.debug.bind(console),d.log=console.log.bind(console),d.warn=console.warn.bind(console),d.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var t of e.debug)switch(t){case"trace":d.trace=console.trace.bind(console);break;case"debug":d.debug=console.debug.bind(console);break;case"vdebug":d.vdebug=console.debug.bind(console);break;case"log":d.log=console.log.bind(console);break;case"warn":d.warn=console.warn.bind(console);break;case"error":d.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+t+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')");break}d.log("Initializing library");var r=e.dependencies||d.useDefaultDependencies();d.isArray=r.isArray,d.webRTCAdapter=r.webRTCAdapter,d.httpAPICall=r.httpAPICall,d.newWebSocket=r.newWebSocket,d.extension=r.extension,d.extension.init(),d.listDevices=function(e,t){e="function"==typeof e?e:d.noop,null==t&&(t={audio:!0,video:!0}),d.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(t).then((function(t){navigator.mediaDevices.enumerateDevices().then((function(r){d.debug(r),e(r),d.stopAllTracks(t)}))})).catch((function(t){d.error(t),e([])})):(d.warn("navigator.mediaDevices unavailable"),e([]))},d.attachMediaStream=function(e,t){try{e.srcObject=t}catch(r){try{e.src=URL.createObjectURL(t)}catch(r){d.error("Error attaching stream to element")}}},d.reattachMediaStream=function(e,t){try{e.srcObject=t.srcObject}catch(r){try{e.src=t.src}catch(r){d.error("Error reattaching stream to element")}}};var n=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0,o=n?"pagehide":"beforeunload",i=window["on"+o];if(window.addEventListener(o,(function(){for(var e in d.log("Closing window"),d.sessions)d.sessions[e]&&d.sessions[e].destroyOnUnload&&(d.log("Destroying session "+e),d.sessions[e].destroy({unload:!0,notifyDestroyed:!1}));i&&"function"==typeof i&&i()})),d.safariVp8=!1,"safari"===d.webRTCAdapter.browserDetails.browser&&d.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var a of RTCRtpSender.getCapabilities("video").codecs)if(a&&a.mimeType&&"video/vp8"===a.mimeType.toLowerCase()){d.safariVp8=!0;break}d.safariVp8?d.log("This version of Safari supports VP8"):d.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var s=new RTCPeerConnection({});s.createOffer({offerToReceiveVideo:!0}).then((function(e){d.safariVp8=-1!==e.sdp.indexOf("VP8"),d.safariVp8?d.log("This version of Safari supports VP8"):d.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),s.close(),s=null}))}if(d.unifiedPlan=!1,"firefox"===d.webRTCAdapter.browserDetails.browser&&d.webRTCAdapter.browserDetails.version>=59)d.unifiedPlan=!0;else if("chrome"===d.webRTCAdapter.browserDetails.browser&&d.webRTCAdapter.browserDetails.version>=72)d.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var c=new RTCPeerConnection;try{c.addTransceiver("audio"),d.unifiedPlan=!0}catch(u){}c.close()}else d.unifiedPlan=!1;d.initDone=!0,e.callback()}},d.isWebrtcSupported=function(){return!!window.RTCPeerConnection},d.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},d.randomString=function(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",n=0;n<e;n++){var o=Math.floor(Math.random()*t.length);r+=t.substring(o,o+1)}return r};var u=r(3477),l=14.875811571268388,p=102.01502828868293,f=14.875811571268388,m=102.01502828868293;let h="https://i.postimg.cc/3N0bcm0F/Picture-Car.png",v="https://i.postimg.cc/bNC9tsGz/icons8-iphone-se-80.png",g="https://34.143.225.243:8089/janus";"http:"===window.location.protocol&&(g="http://34.143.225.243:8088/janus",console.log(g));var y={name:"App",data(){return{janus:null,error:null,plugin:null,status:null,stream:null,streamList:{selected:null,options:[]},remoteTracks:{},remoteVideos:0,iconCar:h,iconUser:v,latitude:0,longitude:0,center:{lat:0,lng:0},locations:[],currentLocation:null,selectedKey:null,selectedMarker:null,coordinates:{0:{lat:l.toString(),lng:p.toString()},1:{lat:f.toString(),lng:m.toString()}}}},computed:{aDouble(){return this.center}},mounted(){this.setLocationLatLng(),this.dbRef.on("value",(e=>{for(const[t,r]of Object.entries(e.val()))"latitude"==t&&(this.latitude=r,console.log(`${t}: ${r}`),l=r),"longitude"==t&&(this.longitude=r,console.log(`${t}: ${r}`),p=r),this.center={lat:(l+f)/2,lng:(p+m)/2},this.coordinates={0:{lat:l.toString(),lng:p.toString()},1:{lat:f.toString(),lng:m.toString()}}})),this.dbRef1.on("value",(e=>{console.log(e.val());for(const[t,r]of Object.entries(e.val()))"latitude"==t&&(this.latitude=r,console.log(`${t}: ${r}`),f=r),"longitude"==t&&(this.longitude=r,console.log(`${t}: ${r}`),m=r),this.center={lat:(l+f)/2,lng:(p+m)/2},this.coordinates={0:{lat:l.toString(),lng:p.toString()},1:{lat:f.toString(),lng:m.toString()}}})),d.init({debug:!0,dependencies:d.useDefaultDependencies(),callback:()=>{console.log("Connecting to Janus api with server ",g),this.connect(g)}})},methods:{getMarkers(e){return this.selectedKey===e?this.mapMarkerActive:this.mapMarker},getMarkers1(e){return console.log(e),0==e?this.iconCar:1==e?this.iconUser:void 0},getPosition:function(e){return{lat:parseFloat(e.lat),lng:parseFloat(e.lng)}},toggleInfo:function(e,t){this.infoPosition=this.getPosition(e),this.selectedMarker=e,this.selectedKey=t,this.infoOpened=!this.infoOpened},closeInfoWindow:function(){this.infoOpened=!1,this.markerOptions=this.mapMarker},setPlace(e){this.currentLocation=e},setLocationLatLng:function(){navigator.geolocation.getCurrentPosition((e=>{this.center={lat:e.coords.latitude,lng:e.coords.longitude}}))},connect(e){this.janus=new d({server:e,success:()=>{console.log("Connected"),this.attachPlugin()},error:e=>{console.log("Error"),this.onError("Failed to connect janus server",e)},destroyed:()=>{console.log("Destroyed"),window.location.reload()}})},attachPlugin(){this.janus.attach({plugin:"janus.plugin.streaming",opaqueId:"thisisopaqueid",success:e=>{this.plugin=e,console.log("getBitrate : ",this.plugin.getBitrate()),this.updateStreamsList()},error:e=>{this.onError("Error attaching plugin... ",e)},iceState:e=>{console.log("ICE state changed to ",e)},webrtcState:e=>{console.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now")},slowLink:(e,t,r)=>{console.log("Janus reports problems "+(e?"sending":"receiving")+" packets on mid "+r+" ("+t+" lost packets)")},onmessage:(e,t)=>{console.log(" ::: Got a message :::",e);let r=e.result;if(r)r.status&&(this.status=r.status);else if(e.error)return this.onError(e.error),void this.stop();if(t){d.debug("Handling SDP as Well... ",t);let e=-1!==t.sdp.indexOf("stereo=1");this.plugin.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1,data:!0},customizeSdp:t=>{e&&-1==t.sdp.indexOf("stereo=1")&&(t.sdp=t.sdp.replace("useinbandfec=1","useinbandfec=1;stereo=1"))},success:e=>{d.debug("Got SDP!",e);let t={request:"start"};this.plugin.send({message:t,jsep:e})},error:e=>{this.onError("WebRTC Error: ",e),alert("WebRTC error... ",e)}})}},onremotetrack:(e,t,r)=>{d.debug("Remote track (mid="+t+") "+(r?"added":"removed")+":",e),"video"===e.kind&&(this.remoteVideos++,this.stream=new MediaStream,this.stream.addTrack(e.clone()),this.remoteTracks.mid=this.stream,d.log("Created remote audio stream:",this.stream))},oncleanup:()=>{this.onCleanup()}})},updateStreamsList(){this.plugin.send({message:{request:"list"},success:e=>{e||this.onError("Got no response to our query for available streams."),console.log("Updating StreamList....",e),this.streamList.options=e.list,e.list.length&&(this.streamList.selected=this.streamList.options[0].id)}})},start(){this.plugin.send({message:{request:"watch",id:this.streamList.selected}})},stop(){this.plugin.send({message:{request:"stop"}}),this.plugin.hangup()},onCleanup(){d.log(" ::: Got a cleanup notification :::"),this.stream=null,this.status=null,this.remoteTracks={},this.remoteVideos=0,this.error=null},onError(e,t=""){d.error(e,t),this.error=e+t,alert(this.error,(function(){window.location.reload()}))}},created(){this.dbRef=u.Z.database().ref("locationCar"),this.dbRef1=u.Z.database().ref("location")},beforeDestroy(){this.dbRef.off()}},b=y,S=r(1001),C=(0,S.Z)(b,i,a,!1,null,"54c0b050",null),T=C.exports,w={name:"StreamingView",components:{Streaming:T}},k=w,R=(0,S.Z)(k,n,o,!1,null,null,null),P=R.exports},4091:function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){const t=e.split("\nm=");return t.map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const r=t.splitSections(e);return r&&r[0]},t.getMediaSections=function(e){const r=t.splitSections(e);return r.shift(),r},t.matchPrefix=function(e,r){return t.splitLines(e).filter((e=>0===e.indexOf(r)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const r={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1]);break}return r},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){let t=e.substr(9).split(" ");const r={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),r.name=t[0],r.clockRate=parseInt(t[1],10),r.channels=3===t.length?parseInt(t[2],10):1,r.numChannels=r.channels,r},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){const t={};let r;const n=e.substr(e.indexOf(" ")+1).split(";");for(let o=0;o<n.length;o++)r=n[o].trim().split("="),t[r[0].trim()]=r[1];return t},t.writeFmtp=function(e){let t="",r=e.payloadType;if(void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const n=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?n.push(t+"="+e.parameters[t]):n.push(t)})),t+="a=fmtp:"+r+" "+n.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},t.parseSsrcGroup=function(e){const t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const r=t.matchPrefix(e,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(e){const t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,r){const n=t.matchPrefix(e+r,"a=fingerprint:");return{role:"auto",fingerprints:n.map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let r="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),r},t.parseCryptoLine=function(e){const t=e.substr(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substr(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,r){const n=t.matchPrefix(e+r,"a=crypto:");return n.map(t.parseCryptoLine)},t.getIceParameters=function(e,r){const n=t.matchPrefix(e+r,"a=ice-ufrag:")[0],o=t.matchPrefix(e+r,"a=ice-pwd:")[0];return n&&o?{usernameFragment:n.substr(12),password:o.substr(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=t.splitLines(e),o=n[0].split(" ");for(let i=3;i<o.length;i++){const n=o[i],a=t.matchPrefix(e,"a=rtpmap:"+n+" ")[0];if(a){const o=t.parseRtpMap(a),i=t.matchPrefix(e,"a=fmtp:"+n+" ");switch(o.parameters=i.length?t.parseFmtp(i[0]):{},o.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+n+" ").map(t.parseRtcpFb),r.codecs.push(o),o.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(o.name.toUpperCase());break;default:break}}}return t.matchPrefix(e,"a=extmap:").forEach((e=>{r.headerExtensions.push(t.parseExtmap(e))})),r},t.writeRtpDescription=function(e,r){let n="";n+="m="+e+" ",n+=r.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=r.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",r.codecs.forEach((e=>{n+=t.writeRtpMap(e),n+=t.writeFmtp(e),n+=t.writeRtcpFb(e)}));let o=0;return r.codecs.forEach((e=>{e.maxptime>o&&(o=e.maxptime)})),o>0&&(n+="a=maxptime:"+o+"\r\n"),r.headerExtensions&&r.headerExtensions.forEach((e=>{n+=t.writeExtmap(e)})),n},t.parseRtpEncodingParameters=function(e){const r=[],n=t.parseRtpParameters(e),o=-1!==n.fecMechanisms.indexOf("RED"),i=-1!==n.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),s=a.length>0&&a[0].ssrc;let c;const d=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>{const t=e.substr(17).split(" ");return t.map((e=>parseInt(e,10)))}));d.length>0&&d[0].length>1&&d[0][0]===s&&(c=d[0][1]),n.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:s,codecPayloadType:parseInt(e.parameters.apt,10)};s&&c&&(t.rtx={ssrc:c}),r.push(t),o&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:s,mechanism:i?"red+ulpfec":"red"},r.push(t))}})),0===r.length&&s&&r.push({ssrc:s});let u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,r.forEach((e=>{e.maxBitrate=u}))),r},t.parseRtcpParameters=function(e){const r={},n=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];n&&(r.cname=n.value,r.ssrc=n.ssrc);const o=t.matchPrefix(e,"a=rtcp-rsize");r.reducedSize=o.length>0,r.compound=0===o.length;const i=t.matchPrefix(e,"a=rtcp-mux");return r.mux=i.length>0,r},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let r;const n=t.matchPrefix(e,"a=msid:");if(1===n.length)return r=n[0].substr(7).split(" "),{stream:r[0],track:r[1]};const o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return o.length>0?(r=o[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(e){const r=t.parseMLine(e),n=t.matchPrefix(e,"a=max-message-size:");let o;n.length>0&&(o=parseInt(n[0].substr(19),10)),isNaN(o)&&(o=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substr(12),10),protocol:r.fmt,maxMessageSize:o};const a=t.matchPrefix(e,"a=sctpmap:");if(a.length>0){const e=a[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:o}}},t.writeSctpDescription=function(e,t){let r=[];return r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,r,n){let o;const i=void 0!==r?r:2;o=e||t.generateSessionId();const a=n||"thisisadapterortc";return"v=0\r\no="+a+" "+o+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,r){const n=t.splitLines(e);for(let t=0;t<n.length;t++)switch(n[t]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[t].substr(2);default:}return r?t.getDirection(r):"sendrecv"},t.getKind=function(e){const r=t.splitLines(e),n=r[0].split(" ");return n[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const r=t.splitLines(e),n=r[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const r=t.matchPrefix(e,"o=")[0],n=r.substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!==typeof e||0===e.length)return!1;const r=t.splitLines(e);for(let t=0;t<r.length;t++)if(r[t].length<2||"="!==r[t].charAt(1))return!1;return!0},e.exports=t},7435:function(e,t,r){r.r(t),r.d(t,{default:function(){return ue}});var n={};r.r(n),r.d(n,{fixNegotiationNeeded:function(){return I},shimAddTrackRemoveTrack:function(){return A},shimAddTrackRemoveTrackWithNative:function(){return E},shimGetDisplayMedia:function(){return T},shimGetSendersWithDtmf:function(){return R},shimGetStats:function(){return P},shimGetUserMedia:function(){return C},shimMediaStream:function(){return w},shimOnTrack:function(){return k},shimPeerConnection:function(){return _},shimSenderReceiverGetStats:function(){return D}});var o={};r.r(o),r.d(o,{shimAddTransceiver:function(){return U},shimCreateAnswer:function(){return z},shimCreateOffer:function(){return G},shimGetDisplayMedia:function(){return M},shimGetParameters:function(){return J},shimGetUserMedia:function(){return x},shimOnTrack:function(){return O},shimPeerConnection:function(){return j},shimRTCDataChannel:function(){return F},shimReceiverGetStats:function(){return V},shimRemoveStream:function(){return N},shimSenderGetStats:function(){return L}});var i={};r.r(i),r.d(i,{shimAudioContext:function(){return Q},shimCallbacksAPI:function(){return q},shimConstraints:function(){return $},shimCreateOfferLegacy:function(){return Y},shimGetUserMedia:function(){return K},shimLocalStreamsAPI:function(){return W},shimRTCIceServerUrls:function(){return H},shimRemoteStreamsAPI:function(){return B},shimTrackEventTransceiver:function(){return Z}});var a={};r.r(a),r.d(a,{removeExtmapAllowMixed:function(){return ie},shimAddIceCandidateNullOrEmpty:function(){return ae},shimConnectionState:function(){return oe},shimMaxMessageSize:function(){return re},shimParameterlessSetLocalDescription:function(){return se},shimRTCIceCandidate:function(){return te},shimSendThrowTypeError:function(){return ne}});r(1703);let s=!0,c=!0;function d(e,t,r){const n=e.match(t);return n&&n.length>=r&&parseInt(n[r],10)}function u(e,t,r){if(!e.RTCPeerConnection)return;const n=e.RTCPeerConnection.prototype,o=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return o.apply(this,arguments);const i=e=>{const t=r(e);t&&(n.handleEvent?n.handleEvent(t):n(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(n,i),o.apply(this,[e,i])};const i=n.removeEventListener;n.removeEventListener=function(e,r){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(r))return i.apply(this,arguments);const n=this._eventMap[t].get(r);return this._eventMap[t].delete(r),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function l(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(s=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function p(e){return"boolean"!==typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function f(){if("object"===typeof window){if(s)return;"undefined"!==typeof console&&"function"===typeof console.log&&console.log.apply(console,arguments)}}function m(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function h(e){const t={browser:null,version:null};if("undefined"===typeof e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:r}=e;if(r.mozGetUserMedia)t.browser="firefox",t.version=d(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=d(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=d(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function v(e){return"[object Object]"===Object.prototype.toString.call(e)}function g(e){return v(e)?Object.keys(e).reduce((function(t,r){const n=v(e[r]),o=n?g(e[r]):e[r],i=n&&!Object.keys(o).length;return void 0===o||i?t:Object.assign(t,{[r]:o})}),{}):e}function y(e,t,r){t&&!r.has(t.id)&&(r.set(t.id,t),Object.keys(t).forEach((n=>{n.endsWith("Id")?y(e,e.get(t[n]),r):n.endsWith("Ids")&&t[n].forEach((t=>{y(e,e.get(t),r)}))})))}function b(e,t,r){const n=r?"outbound-rtp":"inbound-rtp",o=new Map;if(null===t)return o;const i=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((t=>{e.forEach((r=>{r.type===n&&r.trackId===t.id&&y(e,r,o)}))})),o}r(2801),r(6699);const S=f;function C(e,t){const r=e&&e.navigator;if(!r.mediaDevices)return;const n=function(e){if("object"!==typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((r=>{if("require"===r||"advanced"===r||"mediaSource"===r)return;const n="object"===typeof e[r]?e[r]:{ideal:e[r]};void 0!==n.exact&&"number"===typeof n.exact&&(n.min=n.max=n.exact);const o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];let e={};"number"===typeof n.ideal?(e[o("min",r)]=n.ideal,t.optional.push(e),e={},e[o("max",r)]=n.ideal,t.optional.push(e)):(e[o("",r)]=n.ideal,t.optional.push(e))}void 0!==n.exact&&"number"!==typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=n.exact):["min","max"].forEach((e=>{void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=n[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,o){if(t.version>=61)return o(e);if(e=JSON.parse(JSON.stringify(e)),e&&"object"===typeof e.audio){const t=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),t(e.audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=n(e.audio)}if(e&&"object"===typeof e.video){let i=e.video.facingMode;i=i&&("object"===typeof i?i:{ideal:i});const a=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||a)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return r.mediaDevices.enumerateDevices().then((r=>{r=r.filter((e=>"videoinput"===e.kind));let a=r.find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!a&&r.length&&t.includes("back")&&(a=r[r.length-1]),a&&(e.video.deviceId=i.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=n(e.video),S("chrome: "+JSON.stringify(e)),o(e)}))}e.video=n(e.video)}return S("chrome: "+JSON.stringify(e)),o(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}},a=function(e,t,n){o(e,(e=>{r.webkitGetUserMedia(e,t,(e=>{n&&n(i(e))}))}))};if(r.getUserMedia=a.bind(r),r.mediaDevices.getUserMedia){const e=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(t){return o(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(i(e))))))}}}function T(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"===typeof t?e.navigator.mediaDevices.getDisplayMedia=function(r){return t(r).then((t=>{const n=r.video&&r.video.width,o=r.video&&r.video.height,i=r.video&&r.video.frameRate;return r.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},n&&(r.video.mandatory.maxWidth=n),o&&(r.video.mandatory.maxHeight=o),e.navigator.mediaDevices.getUserMedia(r)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function w(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function k(e){if("object"===typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.track.id)):{track:r.track};const o=new Event("track");o.track=r.track,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)})),t.stream.getTracks().forEach((r=>{let n;n=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===r.id)):{track:r};const o=new Event("track");o.track=r,o.receiver=n,o.transceiver={receiver:n},o.streams=[t.stream],this.dispatchEvent(o)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else u(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function R(e){if("object"===typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){let o=r.apply(this,arguments);return o||(o=t(this,e),this._senders.push(o)),o};const n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){n.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"===typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function P(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,r,n]=arguments;if(arguments.length>0&&"function"===typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!==typeof e))return t.apply(this,[]);const o=function(e){const t={},r=e.result();return r.forEach((e=>{const r={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{r[t]=e.stat(t)})),t[r.id]=r})),t},i=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const n=function(e){r(i(o(e)))};return t.apply(this,[n,e])}return new Promise(((e,r)=>{t.apply(this,[function(t){e(i(o(t)))},r])})).then(r,n)}}function D(e){if(!("object"===typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>b(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),u(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>b(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,r,n;return this.getSenders().forEach((r=>{r.track===e&&(t?n=!0:t=r)})),this.getReceivers().forEach((t=>(t.track===e&&(r?n=!0:r=t),t.track===e))),n||t&&r?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():r?r.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function E(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){if(!r)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const n=t.apply(this,arguments);return this._shimmedLocalStreams[r.id]?-1===this._shimmedLocalStreams[r.id].indexOf(n)&&this._shimmedLocalStreams[r.id].push(n):this._shimmedLocalStreams[r.id]=[r,n],n};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{const t=this.getSenders().find((t=>t.track===e));if(t)throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();r.apply(this,arguments);const n=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(n)};const n=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],n.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const r=this._shimmedLocalStreams[t].indexOf(e);-1!==r&&this._shimmedLocalStreams[t].splice(r,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),o.apply(this,arguments)}}function A(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return E(e);const r=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{const t=this.getSenders().find((t=>t.track===e));if(t)throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const r=new e.MediaStream(t.getTracks());this._streams[t.id]=r,this._reverseStreams[r.id]=t,t=r}n.apply(this,[t])};const o=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(o.id,"g"),n.id)})),new RTCSessionDescription({type:t.type,sdp:r})}function a(e,t){let r=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const n=e._reverseStreams[t],o=e._streams[n.id];r=r.replace(new RegExp(n.id,"g"),o.id)})),new RTCSessionDescription({type:t.type,sdp:r})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,r){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");const o=this.getSenders().find((e=>e.track===t));if(o)throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const i=this._streams[r.id];if(i)i.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const n=new e.MediaStream([t]);this._streams[r.id]=n,this._reverseStreams[n.id]=r,this.addStream(n)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){const e=arguments,t=arguments.length&&"function"===typeof arguments[0];return t?r.apply(this,[t=>{const r=i(this,t);e[0].apply(null,[r])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):r.apply(this,arguments).then((e=>i(this,e)))}};e.RTCPeerConnection.prototype[t]=n[t]}));const s=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=a(this,arguments[0]),s.apply(this,arguments)):s.apply(this,arguments)};const c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=c.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");const t=e._pc===this;if(!t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let r;this._streams=this._streams||{},Object.keys(this._streams).forEach((t=>{const n=this._streams[t].getTracks().find((t=>e.track===t));n&&(r=this._streams[t])})),r&&(1===r.getTracks().length?this.removeStream(this._reverseStreams[r.id]):r.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function _(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}))}function I(e,t){u(e,"negotiationneeded",(e=>{const r=e.target;if(!(t.version<72||r.getConfiguration&&"plan-b"===r.getConfiguration().sdpSemantics)||"stable"===r.signalingState)return e}))}function x(e,t){const r=e&&e.navigator,n=e&&e.MediaStreamTrack;if(r.getUserMedia=function(e,t,n){m("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(t,n)},!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){const e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},t=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(r){return"object"===typeof r&&"object"===typeof r.audio&&(r=JSON.parse(JSON.stringify(r)),e(r.audio,"autoGainControl","mozAutoGainControl"),e(r.audio,"noiseSuppression","mozNoiseSuppression")),t(r)},n&&n.prototype.getSettings){const t=n.prototype.getSettings;n.prototype.getSettings=function(){const r=t.apply(this,arguments);return e(r,"mozAutoGainControl","autoGainControl"),e(r,"mozNoiseSuppression","noiseSuppression"),r}}if(n&&n.prototype.applyConstraints){const t=n.prototype.applyConstraints;n.prototype.applyConstraints=function(r){return"audio"===this.kind&&"object"===typeof r&&(r=JSON.parse(JSON.stringify(r)),e(r,"autoGainControl","mozAutoGainControl"),e(r,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[r])}}}}function M(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(r){if(!r||!r.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===r.video?r.video={mediaSource:t}:r.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(r)})}function O(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function j(e,t){if("object"!==typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const r=e.RTCPeerConnection.prototype[t],n={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=n[t]}));const r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,o,i]=arguments;return n.apply(this,[e||null]).then((e=>{if(t.version<53&&!o)try{e.forEach((e=>{e.type=r[e.type]||e.type}))}catch(n){if("TypeError"!==n.name)throw n;e.forEach(((t,n)=>{e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))}))}return e})).then(o,i)}}function L(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function V(e){if("object"!==typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),u(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function N(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){m("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function F(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function U(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];const e=arguments[1],r=e&&"sendEncodings"in e;r&&e.sendEncodings.forEach((e=>{if("rid"in e){const t=/^[a-z0-9]{0,16}$/i;if(!t.test(e.rid))throw new TypeError("Invalid RID value provided.")}if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const n=t.apply(this,arguments);if(r){const{sender:t}=n,r=t.getParameters();(!("encodings"in r)||1===r.encodings.length&&0===Object.keys(r.encodings[0]).length)&&(r.encodings=e.sendEncodings,t.sendEncodings=e.sendEncodings,this.setParametersPromises.push(t.setParameters(r).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return n})}function J(e){if("object"!==typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function G(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function z(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function W(e){if("object"===typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((r=>t.call(this,r,e))),e.getVideoTracks().forEach((r=>t.call(this,r,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...r){return r&&r.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const r=e.getTracks();this.getSenders().forEach((e=>{r.includes(e.track)&&this.removeTrack(e)}))})}}function B(e){if("object"===typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const r=new Event("addstream");r.stream=t,e.dispatchEvent(r)}))}),t.apply(e,arguments)}}}function q(e){if("object"!==typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,r=t.createOffer,n=t.createAnswer,o=t.setLocalDescription,i=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],o=r.apply(this,[n]);return t?(o.then(e,t),Promise.resolve()):o},t.createAnswer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],o=n.apply(this,[r]);return t?(o.then(e,t),Promise.resolve()):o};let s=function(e,t,r){const n=o.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n};t.setLocalDescription=s,s=function(e,t,r){const n=i.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.setRemoteDescription=s,s=function(e,t,r){const n=a.apply(this,[e]);return r?(n.then(t,r),Promise.resolve()):n},t.addIceCandidate=s}function K(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,r=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>r($(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,r,n){t.mediaDevices.getUserMedia(e).then(r,n)}.bind(t))}function $(e){return e&&void 0!==e.video?Object.assign({},e,{video:g(e.video)}):e}function H(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,r){if(e&&e.iceServers){const t=[];for(let r=0;r<e.iceServers.length;r++){let n=e.iceServers[r];!n.hasOwnProperty("urls")&&n.hasOwnProperty("url")?(m("RTCIceServer.url","RTCIceServer.urls"),n=JSON.parse(JSON.stringify(n)),n.urls=n.url,delete n.url,t.push(n)):t.push(e.iceServers[r])}e.iceServers=t}return new t(e,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get(){return t.generateCertificate}})}function Z(e){"object"===typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){"undefined"!==typeof e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),"undefined"!==typeof e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const r=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveVideo||r||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Q(e){"object"!==typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var X=r(4091),ee=r.n(X);function te(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){const r=new t(e),n=ee().parseCandidate(e.candidate),o=Object.assign(r,n);return o.toJSON=function(){return{candidate:o.candidate,sdpMid:o.sdpMid,sdpMLineIndex:o.sdpMLineIndex,usernameFragment:o.usernameFragment}},o}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,u(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function re(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp}});const r=function(e){if(!e||!e.sdp)return!1;const t=ee().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=ee().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))},n=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const r=parseInt(t[1],10);return r!==r?-1:r},o=function(e){let r=65536;return"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r},i=function(e,r){let n=65536;"firefox"===t.browser&&57===t.version&&(n=65535);const o=ee().matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?n=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==r&&(n=2147483637),n},a=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return"undefined"===typeof this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(r(arguments[0])){const e=n(arguments[0]),t=o(e),r=i(arguments[0],e);let a;a=0===t&&0===r?Number.POSITIVE_INFINITY:0===t||0===r?Math.max(t,r):Math.min(t,r);const s={};Object.defineProperty(s,"maxMessageSize",{get(){return a}}),this._sctp=s}return a.apply(this,arguments)}}function ne(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const r=e.send;e.send=function(){const n=arguments[0],o=n.length||n.size||n.byteLength;if("open"===e.readyState&&t.sctp&&o>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return r.apply(e,arguments)}}const r=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=r.apply(this,arguments);return t(e,this),e},u(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function oe(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const r=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const r=new Event("connectionstatechange",e);t.dispatchEvent(r)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}}))}function ie(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const r=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:r}):t.sdp=r}return r.apply(this,arguments)}}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.addIceCandidate;r&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function se(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype.setLocalDescription;r&&0!==r.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!==typeof e||e.type&&e.sdp)return r.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer";break}if(e.sdp||"offer"!==e.type&&"answer"!==e.type)return r.apply(this,[e]);const t="offer"===e.type?this.createOffer:this.createAnswer;return t.apply(this).then((e=>r.apply(this,[e])))})}function ce({window:e}={},t={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const r=f,s=h(e),c={browserDetails:s,commonShim:a,extractVersion:d,disableLog:l,disableWarnings:p,sdp:X};switch(s.browser){case"chrome":if(!n||!_||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),c;if(null===s.version)return r("Chrome shim can not determine version, not shimming."),c;r("adapter.js shimming chrome."),c.browserShim=n,ae(e,s),se(e,s),C(e,s),w(e,s),_(e,s),k(e,s),A(e,s),R(e,s),P(e,s),D(e,s),I(e,s),te(e,s),oe(e,s),re(e,s),ne(e,s),ie(e,s);break;case"firefox":if(!o||!j||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),c;r("adapter.js shimming firefox."),c.browserShim=o,ae(e,s),se(e,s),x(e,s),j(e,s),O(e,s),N(e,s),L(e,s),V(e,s),F(e,s),U(e,s),J(e,s),G(e,s),z(e,s),te(e,s),oe(e,s),re(e,s),ne(e,s);break;case"safari":if(!i||!t.shimSafari)return r("Safari shim is not included in this adapter release."),c;r("adapter.js shimming safari."),c.browserShim=i,ae(e,s),se(e,s),H(e,s),Y(e,s),q(e,s),W(e,s),B(e,s),Z(e,s),K(e,s),Q(e,s),te(e,s),re(e,s),ne(e,s),ie(e,s);break;default:r("Unsupported browser!");break}return c}const de=ce({window:"undefined"===typeof window?void 0:window});var ue=de}}]);
//# sourceMappingURL=about.ece73c27.js.map